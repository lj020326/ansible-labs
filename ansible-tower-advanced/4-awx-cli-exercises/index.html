<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="description" content="Ansible and Ansible Tower Labs">
<meta name="author" content="Christian, Eric, Götz, Ismail, Joachim">

    <link rel="icon" href="https://lj020326.github.io/ansible-labs/images/favicon.png" type="image/png">

    <title>Creating Tower Objects Using `awx` :: Ansible Labs for AnsibleFest</title>

    
    <link href="https://lj020326.github.io/ansible-labs/css/nucleus.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/fontawesome-all.min.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/hybrid.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/featherlight.min.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/perfect-scrollbar.min.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/auto-complete.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/atom-one-dark-reasonable.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/theme.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/tabs.css?1647023409" rel="stylesheet">
    <link href="https://lj020326.github.io/ansible-labs/css/hugo-theme.css?1647023409" rel="stylesheet">
    
    <link href="https://lj020326.github.io/ansible-labs/css/theme-red.css?1647023409" rel="stylesheet">
    
    

    <script src="https://lj020326.github.io/ansible-labs/js/jquery-3.3.1.min.js?1647023409"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/4-awx-cli-exercises/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://lj020326.github.io/ansible-labs/">
  <img src="https://lj020326.github.io/ansible-labs/images/email_ansiblefest-2020.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://lj020326.github.io/ansible-labs/js/lunr.min.js?1647023409"></script>
<script type="text/javascript" src="https://lj020326.github.io/ansible-labs/js/auto-complete.js?1647023409"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/lj020326.github.io\/ansible-labs\/";
    
</script>
<script type="text/javascript" src="https://lj020326.github.io/ansible-labs/js/search.js?1647023409"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://lj020326.github.io/ansible-labs/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/" title="Ansible Tower Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/">
          Ansible Tower Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/1-intro/" title="Introduction to Tower" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/1-intro/">
          Introduction to Tower
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-tower-advanced/" title="Ansible Tower Advanced" class="dd-item
        parent
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/">
          Ansible Tower Advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/1-intro/" title="Ansible Tower Advanced" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/1-intro/">
          Ansible Tower Advanced
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/2-clustering/" title="Introduction to Ansible Tower Clustering" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/2-clustering/">
          Introduction to Ansible Tower Clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/3-awx-cli-intro/" title="There is more to Tower than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/3-awx-cli-intro/">
          There is more to Tower than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/4-awx-cli-exercises/" title="Creating Tower Objects Using `awx`" class="dd-item
        parent
        active
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/4-awx-cli-exercises/">
          Creating Tower Objects Using `awx`
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/5-tower-cluster-jobs/" title="Run a Job in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/5-tower-cluster-jobs/">
          Run a Job in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/6-instance-groups/" title="Tower Instance Groups" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/6-instance-groups/">
          Tower Instance Groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/7-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/7-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/8-isolated-nodes/" title="Isolated Nodes" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/8-isolated-nodes/">
          Isolated Nodes
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/9-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/9-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/10-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/10-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/11-rest-api/" title="Discovering the Tower API" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/11-rest-api/">
          Discovering the Tower API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in Tower" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/4-using-collections-from-tower/">
          Collections in Tower
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://lj020326.github.io/ansible-labs/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://lj020326.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://lj020326.github.io/ansible-labs/'></a> > <a href='https://lj020326.github.io/ansible-labs/ansible-tower-advanced/'>Ansible Tower Advanced</a> > Creating Tower Objects Using `awx`
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#create-an-inventory">Create an Inventory</a>
      <ul>
        <li><a href="#add-hosts-to-the-inventory-using-awx">Add Hosts to the Inventory using <strong>awx</strong></a></li>
      </ul>
    </li>
    <li><a href="#create-script-to-contain-this-and-all-following-awx-commands">Create script to contain this and all following awx commands</a></li>
    <li><a href="#create-machine-credentials">Create Machine Credentials</a></li>
    <li><a href="#create-the-project">Create the Project</a></li>
    <li><a href="#create-a-job-template">Create a Job Template</a></li>
    <li><a href="#attach-credentials-to-job-template">Attach Credentials to Job Template</a></li>
    <li><a href="#review-the-final-script-and-execute-it">Review the final script and execute it</a></li>
    <li><a href="#take-away">Take away</a></li>
    <li><a href="#its-a-cluster-after-all">It’s a Cluster After All</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Creating Tower Objects Using `awx`
            </h1>
          

        



	<p>Next we want to configure Tower so that we can run Ansible jobs. For this we need Inventories, Projects, Credentials and Job Templates. When you first start with Tower, this is usually done via web UI. But using Tower more often and especially when you want to boot-strap a configured Tower from the bottom up it makes sense to do this via <strong>awx</strong> in a scripted way - especially when Ansible is not yet set up properly.</p>
<p>In the first step you will learn to setup the inventory with <strong>awx</strong> step by step to get practice using the tool. For the following steps (Projects, Credentials, Job Templates) we will not go into such detail. Instead we will just explain the actual <strong>awx</strong> commands and put them all into a shell script. This shell script will serve as an example of how to bootstrap a Tower from bottom up.</p>
<h2 id="create-an-inventory">Create an Inventory</h2>
<p>First we create a static inventory, we’ll get to dynamic inventories later on. Try to figure out the proper invocation of <strong>awx</strong> yourself and create an inventory name <strong>Example Inventory</strong>.</p>

<div class="notices tip" ><p>Remember how you used the <strong>awx</strong> help to get down to the needed command.</p>
</div>

<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student@ansible-1 ~<span style="color:#f92672">]</span>$ awx -f human inventory create --name <span style="color:#e6db74">&#34;Example Inventory&#34;</span> --organization <span style="color:#e6db74">&#34;Default&#34;</span>
</code></pre></div>
<div class="notices note" ><p>You can work with multiple organizations in Tower. In this lab we’ll work in the <strong>Default</strong> organization.</p>
</div>

</p>
<hr/>
</details>
<h3 id="add-hosts-to-the-inventory-using-awx">Add Hosts to the Inventory using <strong>awx</strong></h3>
<p>Now that we have the empty inventory created, add your two managed hosts using their internal hostnames <strong><code>node1</code></strong> and <strong><code>node2</code></strong>, again using
<strong>awx</strong>.</p>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student@ansible-1 ~<span style="color:#f92672">]</span>$ awx -f human host create --name <span style="color:#e6db74">&#34;node1&#34;</span> --inventory <span style="color:#e6db74">&#34;Example Inventory&#34;</span>
<span style="color:#f92672">[</span>student@ansible-1 ~<span style="color:#f92672">]</span>$ awx -f human host create --name <span style="color:#e6db74">&#34;node2&#34;</span> --inventory <span style="color:#e6db74">&#34;Example Inventory&#34;</span>
</code></pre></div></p>
<hr/>
</details>
<h2 id="create-script-to-contain-this-and-all-following-awx-commands">Create script to contain this and all following awx commands</h2>
<p>As mentioned one of the purposes of <strong>awx</strong> is to use it to automatically configure more complex Tower setups. In such cases, multiple <strong>awx</strong> commands are put together in a script. We follow that practice in our example here, and create a shell script on the control host with all commands you have to run to bootstrap Tower. So in the next few paragraphs we describe the steps to do and describe the corresponding <strong>awx</strong> commands. But we will not execute them, but instead write them into a script.</p>
<p>In <strong>code-server</strong> create a new file <strong>File-&gt;New File</strong> and save it (<strong>File-&gt;Save As</strong>) as <strong><code>setup-tower.sh</code></strong>. Add the commands executed above:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>awx -f human inventory create --name <span style="color:#e6db74">&#34;Example Inventory&#34;</span> --organization <span style="color:#e6db74">&#34;Default&#34;</span>
awx -f human host create --name <span style="color:#e6db74">&#34;node1&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --inventory <span style="color:#e6db74">&#34;Example Inventory&#34;</span>
awx -f human host create --name <span style="color:#e6db74">&#34;node2&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    --inventory <span style="color:#e6db74">&#34;Example Inventory&#34;</span>
</code></pre></div>
<div class="notices tip" ><p>You have run these commands above already, true. But we want to show how to create
the full script here. You&rsquo;ll get &ldquo;Duplicate&rdquo; messages because the objects already exist.</p>
</div>

<p>Next, save the script and make the script executable in the terminal window. Then launch it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>student@ansible-1 ~<span style="color:#f92672">]</span>$ chmod u+x /home/student&lt;N&gt;/setup-tower.sh
<span style="color:#f92672">[</span>student@ansible-1 ~<span style="color:#f92672">]</span>$ /home/student&lt;N&gt;/setup-tower.sh
</code></pre></div><p>From now on we’ll explain the needed commands for each of the next steps and add them to the script one-by-one.</p>
<h2 id="create-machine-credentials">Create Machine Credentials</h2>

<div class="notices tip" ><p>SSH keys have already been created and distributed in your lab environment and <code>sudo</code> has been setup on the managed hosts to allow password-less login. When you SSH into a host as user <strong>student&lt;N&gt;</strong> from <strong>ansible-1</strong> you will become user <strong>ec2-user</strong> on the host you logged in.</p>
</div>

<p>Now we want to configure these credentials to access our managed hosts from Tower. Add the following to to <strong><code>setup-tower.sh</code></strong>, but don’t run the script yet:</p>
<pre><code>awx -f human credential create --name &quot;Example Credentials&quot; \
    --organization &quot;Default&quot; \
    --credential_type &quot;Machine&quot; \
    --inputs '{&quot;username&quot;: &quot;ec2-user&quot;, &quot;ssh_key_data&quot;: &quot;@~/.ssh/aws-private.pem&quot;}'
</code></pre>
<p>Don’t run the shell script yet, first go through the following steps to add all commands to it.</p>

<div class="notices warning" ><p>As the <strong>awx</strong> commands get longer you’ll find we use the back-slash for line wraps to make the commands readable. You can copy the examples or use them without the \ in one line, of course.</p>
</div>

<h2 id="create-the-project">Create the Project</h2>
<p>The Ansible content used in this lab is hosted on Github. The next step is to add a project to import the playbooks. Add the appropriate <strong>awx</strong> command to the script <strong><code>setup-tower.sh</code></strong>:</p>
<pre><code>awx -f human project create --name=&quot;Apache&quot; \
    --scm_type=git \
    --scm_url=&quot;https://github.com/lj020326/ansible-labs-playbooks.git&quot; \
    --organization &quot;Default&quot; \
    --scm_clean=true --scm_delete_on_update=true --scm_update_on_launch=true \
    --wait
</code></pre>

<div class="notices tip" ><p>Note that the first parameter to <strong>awx</strong> is different here since we work on the resource <strong>project</strong>.</p>
</div>

<h2 id="create-a-job-template">Create a Job Template</h2>
<p>Before running an Ansible <strong>Job</strong> from your Tower cluster you must create a <strong>Job Template</strong>, again business as usual for Tower users. Here <strong>awx</strong> will work on the resource <strong>job_template</strong>. Add the following command to your script <strong><code>setup-tower.sh</code></strong>. Don’t run the script yet.</p>
<pre><code>awx -f human job_templates create  \
    --name=&quot;Install Apache&quot; \
    --inventory=&quot;Example Inventory&quot; \
    --project=Apache \
    --playbook=apache_install.yml \
    --become_enabled=&quot;yes&quot;
</code></pre>
<h2 id="attach-credentials-to-job-template">Attach Credentials to Job Template</h2>
<p>And finally we need to attach the credentials we created above to the Job Template. Add the following command to your script <strong><code>setup-tower.sh</code></strong>. Don’t run the script yet.</p>
<pre><code>awx -f human job_template associate --name &quot;Install Apache&quot; \
    --credential &quot;Example Credentials&quot;
</code></pre>
<h2 id="review-the-final-script-and-execute-it">Review the final script and execute it</h2>
<p>Verify that your script has all the pieces needed to properly configure Tower:</p>
<ul>
<li>
<p>inventory with hosts</p>
</li>
<li>
<p>machine credentials and credentials for Git</p>
</li>
<li>
<p>project</p>
</li>
<li>
<p>job template</p>
</li>
</ul>
<p>The final script is also shown here:</p>
<pre><code>#!/bin/bash
awx -f human inventory create --name &quot;Example Inventory&quot; --organization &quot;Default&quot;
awx -f human host create --name &quot;node1&quot; \
    --inventory &quot;Example Inventory&quot;
awx -f human host create --name &quot;node2&quot; \
    --inventory &quot;Example Inventory&quot;
awx -f human credential create --name &quot;Example Credentials&quot; \
    --organization &quot;Default&quot; \
    --credential_type &quot;Machine&quot; \
    --inputs '{&quot;username&quot;: &quot;ec2-user&quot;, &quot;ssh_key_data&quot;: &quot;@~/.ssh/aws-private.pem&quot;}'
awx -f human project create --name=&quot;Apache&quot; \
    --scm_type=git \
    --scm_url=&quot;https://github.com/lj020326/ansible-labs-playbooks.git&quot; \
    --organization &quot;Default&quot; \
    --scm_clean=true --scm_delete_on_update=true --scm_update_on_launch=true \
    --wait
awx -f human job_templates create  \
    --name=&quot;Install Apache&quot; \
    --inventory=&quot;Example Inventory&quot; \
    --project=Apache \
    --playbook=apache_install.yml \
    --become_enabled=&quot;yes&quot;
awx -f human job_template associate --name &quot;Install Apache&quot; \
    --credential &quot;Example Credentials&quot;
</code></pre>
<p><strong>And now:</strong> Run the script (make sure the <code>TOWER_</code> environment variables are defined), and verify that all resources were properly created in the web UI.</p>
<h2 id="take-away">Take away</h2>
<p>It’s easy to script Tower’s configuration using <strong>awx</strong>. This way you can bootstrap a new Tower node or script tasks you have to run on a regular basis. You will learn more about the Tower API at the end of the lab.</p>
<h2 id="its-a-cluster-after-all">It’s a Cluster After All</h2>
<p>We are working in a clustered environment. To verify that the resources were created on all instances properly, login to the other Tower nodes web UI&rsquo;s (You run the <strong>awx</strong> commands against your Tower node 1).</p>
<p>Have a look around, everything we automatically configured on one Tower instance with our script was <strong>synchronized automatically</strong> to the other nodes. Inventory, credentials, projects, templates, all there.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/3-awx-cli-intro/" title="There is more to Tower than the Web UI"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://lj020326.github.io/ansible-labs/ansible-tower-advanced/5-tower-cluster-jobs/" title="Run a Job in a Cluster" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://lj020326.github.io/ansible-labs/js/clipboard.min.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/perfect-scrollbar.min.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/perfect-scrollbar.jquery.min.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/jquery.sticky.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/featherlight.min.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/highlight.pack.js?1647023409"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://lj020326.github.io/ansible-labs/js/modernizr.custom-3.6.0.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/learn.js?1647023409"></script>
    <script src="https://lj020326.github.io/ansible-labs/js/hugo-learn.js?1647023409"></script>
    
        
            <script src="https://lj020326.github.io/ansible-labs/mermaid/mermaid.js?1647023409"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
